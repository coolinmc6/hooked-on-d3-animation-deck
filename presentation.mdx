import { Appear, Notes, Image } from "mdx-deck";
import {
  Split,
  SplitRight,
  FullScreenCode,
  Horizontal
} from "mdx-deck/layouts";
import { CodeSurfer } from "mdx-deck-code-surfer";
import { book } from "mdx-deck/themes";
import nightOwl from "prism-react-renderer/themes/nightOwl";

import Disappear from "components/deck/Disappear";
import CodeSurferContainer from "components/deck/CodeSurferContainer";
import ChartContainer from "components/BarChart/ChartContainer";

export const theme = {
  ...book,
  codeSurfer: { ...nightOwl, showNumbers: false }
};

# Hooked on D3

## Creating Animated Ch(art)s with D3 and React Hooks

<Notes>

- Only visible in presenter mode
- Markdown syntax can be used with empty lines around the content

</Notes>

---

export default Split;

<div
  style={{
    height: "100vh",
    display: "flex",
    alignItems: "center",
    justifyContent: "center"
  }}
>
  <h1 style={{ fontSize: "3em" }}>Hi, I'm Monica!</h1>
</div>

<Appear>
  <div style={{ width: "50%" }}>
    <img src="./images/netguru.svg" />
  </div>
  <h1>Polish 🇵🇱 / American 🇺🇸</h1>
  <h1>Outdoors enthusiast 🌲 🏔️ </h1>
  <h1>Lifelong learner 🏄‍♀️ 🥊 🧗‍♀️ ... 📊 </h1>
</Appear>

---

<div style={{ backgroundImage: `url(./images/boring_chart.gif)`,
    backgroundSize: 'contain',
    width: '40vw',
    height: '40vh',
    backgroundPosition: 'center',
    backgroundRepeat: 'no-repeat'}} />
  
<Appear>
    <h1 style={{ textAlign: 'center'}}>There has to be a better way</h1>
  </Appear>

<Notes>

- my journey with programming began in college when I was a research assistant tasked with showing some data..
- I thought, there has to be something better than this...

</Notes>

---

<div
  style={{
    backgroundImage: `url(./images/d3_gallery.png)`,
    backgroundSize: "cover",
    width: "100vw",
    height: "100vh",
    backgroundPosition: "center",
    backgroundRepeat: "no-repeat"
  }}
/>

<Notes>

- and there was!
- luckily I was thinking out loud and happened to have a computer science roommate who pointed me in the direction of this site
- since then, I've been hooked on D3... and today I'm hooked on D3 and React together :)

</Notes>

---

<div style={{ fontSize: "2em", width: "100vw", height: "100vh" }}>
  <Appear>
    <div
      style={{
        backgroundImage: `url(./images/React-icon.png)`,
        backgroundSize: "contain",
        width: "auto",
        height: "200px",
        backgroundPosition: "center",
        backgroundRepeat: "no-repeat"
      }}
    />
    <div
      style={{
        backgroundImage: `url(./images/d3-icon.png)`,
        backgroundSize: "contain",
        width: "auto",
        height: "200px",
        backgroundPosition: "center",
        backgroundRepeat: "no-repeat"
      }}
    />
    <h1 style={{ textAlign: "center" }}>👨‍🍳 🍳 👩‍🍳</h1>
    <h1 style={{ textAlign: "center" }}>?</h1>
  </Appear>
</div>

<Notes>

- so today, I want to chat about React and the data visualization lib D3, but also...
- And today, other than talking to you about code, I’ll be sharing some secrets of the art of cooking at a 5-star restaurant…
- So keep that in mind

</Notes>

---

import BoldingText from "components/deck/BoldingText";

<BoldingText />

<Notes>

- But before we jump right into what the title of this presentation promised, “Creating Animated Ch(art)s with D3 and React hooks”, I think we need to take a step back and focus on one word: Animated
- So what is animation but...

</Notes>

---

<h2>
  <strike>Time and Change</strike> Change / Time
</h2>

<Notes>

- Time and Change = Transformation
- Actually Change / Time = Transformation

</Notes>

---

## Why animate?

<ul>
  <Appear>
    <li>🔅 🔆 continuity</li>
    <li>🔄 action / reaction</li>
    <li>🕓 motion</li>
  </Appear>
</ul>

<Notes>

- provides a visual cue of continuity; it's one object
- A reaction to our action (communication of cause-and-effect)
- Motion: A clue that ‘something is happening’ (e.g. Loading component); relationship with time

</Notes>

---

import { Circles, AnimatedCircle } from "components/Circle";

<h2>
  MORE information
  <Appear>
    <span>...but LESS to process at once</span>
  </Appear>
</h2>

<div>
  <Circles />
</div>

<Appear>
  <div>
    <AnimatedCircle />
  </div>
</Appear>

<Notes>

- MORE INFORMATION (not just the snapshots of reality, but their collection)
- …but LESS TO PROCESS AT ONE TIME (our eye then only needs to follow one piece of information, not two simultaneously
- It hints that the takeaway is not in each single frame, but in the space between them. In their relation to one another.

</Notes>

---

# Animation in charts?

<Notes>

so then how does this apply to data visualization?

</Notes>

---

<h2></h2>

<div style={{ width: "100vw", height: "80vh", position: "relative" }}>
  <div
    style={{
      position: "absolute",
      width: "100%",
      height: "100%",
      backgroundSize: "cover",
      backgroundImage: "url(./images/chefs_and_spices.jpg)"
    }}
  />
  <div
    style={{
      position: "absolute",
      background: "#fffceb",
      width: "30%",
      height: "100vh"
    }}
  />
  <div
    style={{
      position: "absolute",
      background: "#fffceb",
      width: "30%",
      height: "100vh",
      left: "70%"
    }}
  />
</div>

<Notes>

- salt and spices represent two different approaches to animation in data visualization.
- And just like a balance of salt and spices wins out in the long run in terms of cooking, this balance is a winner when it comes to ‘when and how to animate charts’ as well
- What do I mean?
  - Salt enhances the underlying elements, but it does not overshadow them
  - Spices, change the flavor profile; they bring your senses to different features
  - It’s actually a combo of salt and spices. We want to direct and disturb focus in the appropriate manner.
- But the trick isn’t just to add salt and add spices, but to add them where they are applicable (there is information in the way you share information)

</Notes>

---

## _When to add_ salt and spices?

<div style={{ width: "100vw", height: "80vh", position: "relative" }}>
  <div
    style={{
      position: "absolute",
      width: "100%",
      height: "100%",
      backgroundSize: "cover",
      backgroundImage: "url(./images/chefs_and_spices.jpg)"
    }}
  />
  <div
    style={{
      position: "absolute",
      background: "#fffceb",
      width: "30%",
      height: "100vh"
    }}
  />
  <div
    style={{
      position: "absolute",
      background: "#fffceb",
      width: "30%",
      height: "100vh",
      left: "70%"
    }}
  />
  <Appear>
    <div
      style={{
        position: "absolute",
        width: "30%",
        top: "10%"
      }}
    >
      <ul>
        <li>
          <h1>A -> B </h1>
        </li>
      </ul>
    </div>
    <div
      style={{
        position: "absolute",
        width: "30%",
        left: "70%",
        top: "10%"
      }}
    >
      <ul>
        <li>
          <h1>
            a<sub>x</sub> -> a<sub>y</sub>
          </h1>
        </li>
      </ul>
    </div>
    <div
      style={{
        position: "absolute",
        width: "30%",
        left: "70%",
        top: "30%"
      }}
    >
      <ul>
        <li>
          <h1>a(t)</h1>
        </li>
      </ul>
    </div>
    <div
      style={{
        position: "absolute",
        width: "30%",
        top: "30%"
      }}
    >
      <ul>
        <li>
          <h1>aaa look here! 👀</h1>
        </li>
      </ul>
    </div>
  </Appear>
</div>

<Notes>

- aka when to add animation to data visualization
- The wrong approach: ‘what animation should we add’ (what spices should we add?)
- The right approach: ‘what animation is our data holding/calling for’ (what are the ingredients asking for?)
  - Transitioning between states (change within group) -> object continuity (A -> A)
    - Position change
    - Shows relationship because it maintains my focus on particular elements
  - Transitioning between states (change of group) (A -> B)
    - Dataset change
    - Shows lack of a relationship between A and B because it interrupts my focus on particular elements
  - Animation as explanation (narration, storytelling)
  - Transition over time (real-time data) NICU (same dataset, but growing)
- It really comes down to three places where animation can add be used to enhance its underlying elements:
  - 1. New dataset (spice, interrupt my current focus, change the flavor)
  - 2. New element in dataset (aka change to dataset) (salt / spice?)
  - 3. Change to element in dataset (salt, maintain my current focus)

</Notes>

---

## _How_ to add salt and spices?

<div style={{ width: "100vw", height: "80vh", position: "relative" }}>
  <Disappear
    elementsToKeep={[
      <div
        style={{
          position: "absolute",
          width: "100%",
          height: "100%",
          backgroundSize: "cover",
          backgroundImage: "url(./images/chefs_and_spices.jpg)"
        }}
      />
    ]}
    elementsToRemove={[
      <div>
        <div
          style={{
            position: "absolute",
            background: "#fffceb",
            width: "30%",
            height: "100vh"
          }}
        />
        <div
          style={{
            position: "absolute",
            background: "#fffceb",
            width: "30%",
            height: "100vh",
            left: "70%"
          }}
        />
      </div>
    ]}
  />
</div>

<Notes>

- aka. how to add animation to data visualisations
- So now we understand that animation can add a lot to a visualization, which is great, but it would probably be helpful to know how to implement this as well ;)
- We talked about spices and salt, so let’s take a look at who would be adding those to a dish:
- this is where our chefs come in!

</Notes>

---

# Two cooks 👨‍🍳 👨‍🍳

<Appear>
  <h1>...one kitchen.</h1>
</Appear>

<Notes>

- have you ever heard the saying, you can’t have two cooks in the kitchen?
- It makes sense right? How can you have one pot, one knife, one cutting board, one set of ingredients, and expect two cooks to create a dish?
- (insert image of two chefs)
- a brief descrription of our two cooks: react (faux DOM) and D3 (DOM)
- There are three ways this situation could play out:

</Notes>

---

export default Split;

<div
  style={{
    margin: "2em"
  }}
>
  <h2>Option 1:</h2>
  <h1>Cook #1 takes control</h1>
</div>

<img src="./images/react_with_hat.png" />

<Notes></Notes>

---

import BarChartReactControl from "components/BarChart/BarChartReactControl";

export default Split;

<div style={{ width: "50vw" }}>
  <CodeSurferContainer percent>
    <CodeSurfer
      title="Bar Chart ala Cook #1 (React)"
      code={
        require("!raw-loader!components/BarChart/BarChartReactControl.js")
          .default
      }
      lang="javascript"
      showNumbers={false}
      dark={true}
      steps={[
        { notes: "" },
        { lines: [6, 10], notes: "Start with this note" },
        { lines: [11, 20], notes: "setup using D3 as utility lib" },
        { range: [22, 32] },
        { range: [34, 44] }
      ]}
    />
  </CodeSurferContainer>
</div>

<ChartContainer
  renderChart={data => (
    <BarChartReactControl data={data} width={400} height={400} />
  )}
/>

---

export default Split;

<div
  style={{
    margin: "2em"
  }}
>
  <h2>Option 2:</h2>
  <h1>Cook #2 takes control</h1>
</div>

<img src="./images/d3_with_hat.png" />

<Notes></Notes>

---

import BarChartD3Control from "components/BarChart/BarChartD3Control";

export default Split;

<div style={{ width: "50vw" }}>
  <CodeSurferContainer percent>
    <CodeSurfer
      title="Bar Chart ala Cook #2 (D3)"
      code={
        require("!raw-loader!components/BarChart/BarChartD3Control.js").default
      }
      lang="javascript"
      showNumbers={false}
      dark={true}
      steps={[
        { notes: "" },
        { lines: [6, 10], notes: "Start with this note" },
        { lines: [11, 20], notes: "setup using D3 as utility lib" },
        { range: [22, 32] },
        { range: [34, 44] }
      ]}
    />
  </CodeSurferContainer>
</div>

<ChartContainer
  renderChart={data => (
    <BarChartD3Control data={data} width={400} height={400} />
  )}
/>

---

export default SplitRight;

<div>
  <img height={300} src="./images/react_with_hat.png" />
  <img height={300} src="./images/d3_with_hat.png" />
</div>

<div
  style={{
    margin: "2em"
  }}
>
  <h2>Option 3:</h2>
  <h1>Cook #1 and Cook #2 share control</h1>
</div>

<Notes>

- React (cook1) preps the ingredients and the pot, D3 (cook2) puts everything in its place

</Notes>

---

import BarChartShareControl from "components/BarChart/BarChartShareControl";

export default Split;

<div style={{ width: "50vw" }}>
  <CodeSurferContainer percent>
    <CodeSurfer
      title="Bar Chart ala Cook #1 and Cook #2 (React + D3)"
      code={
        require("!raw-loader!components/BarChart/BarChartShareControl.js")
          .default
      }
      lang="javascript"
      showNumbers={false}
      dark={true}
      steps={[
        { notes: "" },
        { lines: [6, 10], notes: "Start with this note" },
        { lines: [11, 20], notes: "setup using D3 as utility lib" },
        { range: [22, 32] },
        { range: [34, 44] }
      ]}
    />
  </CodeSurferContainer>
</div>

<ChartContainer
  renderChart={data => (
    <BarChartShareControl data={data} width={400} height={400} />
  )}
/>

---

export default SplitRight;

<div>
  <Appear>
    <img height={300} src="./images/react_chef.png" />
    <img height={300} src="./images/d3_sous_chef.png" />
  </Appear>
</div>

<div
  style={{
    margin: "2em"
  }}
>
  <h2>Option 3 with Hooks:</h2>
  <h1>Chef and Sous Chef</h1>
</div>

<Notes>

- But there’s a difference between working together, and working together in an straightforward, predictable, organised manner:
- not Cook1 and Cook2 but chef and sous chef!
- They need clear communication in order to make their collaboration work. This is where React Hooks come in!
- The chef (React) tells the sous chef (D3) when it needs his/her help, and then gives it free reign to work it’s magic
- React prepares the dish and D3 adds the embellishments, the animations
  - Everything the sous chef does is a side effect, he is making changes to the dish that the chef didn’t make himself
  - But just like in the kitchen, it’s best if one cook adds the spices, so too is true in data viz. react gives the cue, the recipe, and d3 adds the salt and spices.

</Notes>

---

import App from "./components/App/App";

## <App />

<Notes>

- This is what we will be preparing today: The Non-boring Keyboard ala Monica :)
  - the inspiration for this dish is the question ‘how come the keyboard is laid out the way it is?’
  - Description:
    - Each key on my keyboard represents a bar/column in the chart
    - When each key is hit, the bar grows and then falls again (to show that something is being added) and a point is added above it so that we get the distribution of keys over time
    - We can view the data in several ways
      - x-axis is letter order, either based on the keyboard left to right or based on the English alphabet
      - y-axis is either the index of the element added (so we can see a distribution of letters over time) or the cumulative view (so we can see which letters are used most often)
- So let’s make it! to begin, we’re gonna let the chef set things up for us:
  - Sets up the recipe
    - Data useState
  - Gets the pot ready
    - Sets up dimensions
    - Create SVG container
  - Maps the recipe elements to ingredients
    - Create elements based on that data
- Now the chef needs to tell the sous chef where and when he can take control
  - useRef (where)
  - useEffect (when)
- And when it’s his time, the sous chef works his magic
  - updateFunction

</Notes>

---

<CodeSurferContainer>
  <CodeSurfer
    title="Bar Chart ala Cook #1 and #2 (React + D3)"
    code={
      require("!raw-loader!components/BarChart/BarChartShareControl.js").default
    }
    lang="javascript"
    showNumbers={false}
    dark={true}
    steps={[
      { notes: "Start with this note" },
      { lines: [6], notes: "Note for the first step" },
      { range: [5, 9] },
      { tokens: { 9: [3, 4, 5] }, notes: "Note for the third step" }
    ]}
  />
</CodeSurferContainer>

---

## Recap

<div style={{ width: "100vw", height: "80vh", position: "relative" }}>
  <Disappear
    elementsToKeep={[
      <div
        style={{
          position: "absolute",
          width: "100%",
          height: "100%",
          backgroundSize: "cover",
          backgroundImage: "url(./images/chefs_and_spices.jpg)"
        }}
      />
    ]}
    elementsToRemove={[
      <div
        style={{
          width: "15%",
          height: "100%",
          background: "#fffceb",
          opacity: "0.5",
          position: "absolute",
          left: "55%"
        }}
      />,
      <div
        style={{
          width: "25%",
          height: "100%",
          background: "#fffceb",
          opacity: "0.5",
          position: "absolute",
          left: "30%"
        }}
      />,
      <div
        style={{
          width: "30%",
          height: "100%",
          background: "#fffceb",
          opacity: "0.5",
          position: "absolute",
          left: "70%"
        }}
      />,
      <div
        style={{
          width: "30%",
          height: "100%",
          opacity: "0.5",
          background: "#fffceb",
          position: "absolute",
          left: "0"
        }}
      />
    ]}
    elementsToAppear={[
      <div
        style={{
          width: "15%",
          height: "100%",
          position: "absolute",
          left: "55%",
          display: "flex",
          justifyContent: "center",
          alignItems: "flex-start",
          top: "-9%"
        }}
      >
        <p style={{ margin: 0 }}>
          a<sub>i</sub> ➡️ a<sub>j</sub>
        </p>
      </div>,
      <div
        style={{
          width: "25%",
          height: "100%",
          position: "absolute",
          left: "30%",
          display: "flex",
          justifyContent: "center",
          alignItems: "flex-start",
          top: "-9%"
        }}
      >
        {`A ➡️ B`}
      </div>,
      <div>
        <img
          src="./images/d3-icon.png"
          width={"5%"}
          style={{
            position: "absolute",
            left: "78%",
            top: "18%",
            background: "white",
            borderRadius: "10px"
          }}
        />
        <div
          style={{
            width: "30%",
            height: "100%",
            position: "absolute",
            left: "70%",
            display: "flex",
            justifyContent: "center",
            alignItems: "flex-start",
            top: "-7%"
          }}
        >
          <p style={{ margin: 0 }}>
            <i>function</i> update()
          </p>
        </div>
      </div>,
      <div>
        <img
          src="./images/React-icon.svg"
          width={"5%"}
          height={"10%"}
          style={{
            position: "absolute",
            left: "14%",
            top: "20%",
            background: "white",
            borderRadius: "10px",
            backgroundSize: "cover"
          }}
        />
        <div
          style={{
            width: "30%",
            height: "100%",
            position: "absolute",
            left: "0",
            display: "flex",
            justifyContent: "center",
            alignItems: "flex-start",
            top: "-7%"
          }}
        >
          useState, useRef, useEffect
        </div>
      </div>
    ]}
  />
</div>

<Notes>

- Animation: add salt and spices when the dish calls for each
  - 'Salt' animation 🧂: for changes within _piece of data_ (e.g, same 'key', different value)
  - 'Spices' animation 🌶️: for changes within _dataset_ / redirecting focus, (e.g, something added or removed from dataset)
- Creating Animated Charts
- Chef + sous chef for proper communication / delegation of responsibilities 🤝

  - Chef (React): `useState`, `useRef`, `useEffect`
  - Sous chef (D3): `function update()`

- Animation (salt and spices)
  - When it comes to charts, with animation we’re really talking about animated transitions (make visual changes natural/seamless to keep us immersed, a unified whole, a ‘continuation’ of the story). Spices and salt, (animations) should serve to unify the whole. No longer separate ingredients, but a unified flavour profile.
- No two cooks in the kitchen
  - If you’re using D3 with React, put it in its place! It’s a side effect because it affects the DOM in ways outside of directly React. So place it in useEffect
    - “Anything that results in changes that can be observed when the calculation is completed, beside the return value of the calculation itself, is a side effect.”
    - “Calculation should return just result of the calculation. Anything else is side-effect.”
- Chef and sous chef need to have proper communication / delegation of responsibilities for a dish to taste good :)
  - Chef:
    - useState, useRef, useEffect
  - Sous Chef:
    - Update function

</Notes>

---

## Take-out Box

<ul>
  <Appear>
    <li>🙊 Let the ingredients speak, don't speak for them </li>
    <li>👩‍🍳 Don't have too many cooks in the kitchen </li>
    <li>🍳 Cooking isn't baking</li>
  </Appear>
</ul>

<Notes>

- When it comes to animation, we talked about animation, what it is, why it adds value, when to add it, and how to add it to a visualization using D3 and React Hooks...
- but to close, I wanted to leave you with a few takeaways that apply to code and cooking alike:

1. The wrong approach / the right approach to animation:

- Wrong: 'what (animation/seasoning) do we want to add?'
  - In danger of adding too much salt or spices, which can overpower the underlying ingredients they were meant to enhance
- Right: 'what (animations/seasoning) is this (data/dish) calling for?'

2. Don't have two cooks in the kitchen..

- a chef and sous chef, with clear delineation of responsibilities work much better :)

3. Cooking isn't baking

- use patterns, not exact proportions... you can be a little more creative in what exactly you do for each, but you do need to know the foundations
- know how to use a spoon, a spatula, a pot / useState, useEffect, useRef hooks to make creating more pleasant

</Notes>

---

# Bon appetit! 🍽️

---

# Resources
